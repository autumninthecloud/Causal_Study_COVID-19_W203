---
title: "Section_8_Team1_Lab2_Report"
author: "Degnan, Rains, Wu"
date: "8/5/2021"
output:
  html_document:
    df_print: paged
  word_document: default
  pdf_document: default
---

```{r setup, message=FALSE}
install.packages("table1")
install.packages("GGally")

#we may not need all of these
library(tidyverse)
library(magrittr)
library(ggplot2)
library(patchwork)
library(sandwich)
library(lmtest)
library(dplyr)
library(table1)
library("GGally")

theme_set(theme_minimal())
knitr::opts_chunk$set(echo = TRUE)

```

## Introduction

Summer vacations in the United States are synonymous with sunny, leisurely days spent with loved ones. As Ella Fitzgerald so aptly sings, “Summertime, and the living is easy.” However, travel in the recent peak-vacation months has certainly deviated from this idealistic frame of mind with the onset of the COVID-19 pandemic in early 2020. The global travel industry has experienced sharp declines. Specifically in the United States, “travel spending totaled a mere $679 billion in 2020, an unprecedented 42% annual decline (nearly $500 billion) from 2019,” according to analysis from the U.S. Travel Association. 
As infection and vaccination rates oscillate regionally along with government policies for business operation restrictions in the United States, our team of data scientists will look to answer the following research question in more detail using linear regression techniques: 

Do COVID infection rates impact vacation travel distance for U.S. residents in the state of Texas? 
How does income, population density, and covid regulations in each county impact traveling? 

We will analyze datasets pertaining to these variables for Texas counties and create three models to understand if causal relationships exist between distance traveled, population income, population density (rural or urban counties), and government regulations. The outcome variable will be distance traveled. The predictor varialbes will be income, county type (rural or urban), and policy regulations around Covid-19. Our hypothesis is that an there is a causal relationship between these predictor variables and the outcome variable.

## Operationalization

To create our dataframe, we cleaned and filtered data from multiple sources of data and joined based on Texas county name or code. 

#### Operationalization of focus variables
We gathered covid case and death data from NYT. We gathered trip distance data from the Bureau of Transportation, which they record based on data gathered from personal mobile devices. This data was presented as number of travelers in binned distances. We defined a short trip as less than 100 miles and long trips as greater than 100 miles. This was decided under the assumption that distances traveled of less than 100 miles are for the purpose of commuting, while greater than 100 miles indicated vacation travel.

#### Operationalization of additional variables
To enrich our model and limit OVB, we brainstormed a number of additional variables that could affect travel rates during covid. For one, we looked at location due to the assumption that those who live in rural settings are likely to commute farther than those in an urban setting. We also looked at age, gender, income demographics. Finally, we pulled in data for county population to normalize all the data on a per capita basis. 

### Variables

For our analysis, we will use datasets and variables from the four following sources:

[![DataSources](lab2datatable.JPG)](https://ibb.co/zQ3yj2K)

As indicated, each source will provide information on county population demographics such as income, rural vs. urban classification, and status of pandemic regulations. Together, these sources were filtered for the state of Texas and combined to create a dataframe for analysis.

```{r dataframe, echo=FALSE}
df <- read.csv('~/lab-2-lab2_section8_jal/data/interim/covid_trips_interim.csv')
head(df)

```


### Accounting Tables

To demonstrate the operationalization of the data, Tables 1 and 2 below display the original value counts from the dataset as well as how many values were removed as a part of filtering the dataset to remove all states except Texas. For the analysis, 230 responses were analyzed as shown in Table 1. Table 2 depicts the county type breakdown for rural or urban classification as well. 

```{r Accounting Table creation & output}

step_num = c(1,2)

number_of_samples = c(nrow(df), #Need dataframe for all US
                      nrow(df)) 
                                            
samples_removed = c(0,
                    nrow(df)-nrow(df))
                    
                    
reasoning = c("Original Dataset",
              "Filtered for Texas Only")

accounting_df <- data.frame(step_num,
                            number_of_samples,
                            samples_removed,
                            reasoning)

knitr::kable(accounting_df)
colnames(accounting_df) <- c('Step','Number of Samples','Samples Removed', 'Reason')
knitr::kable(accounting_df, caption="Accounting Table", align = "c")

#Need to create column category of rural vs urban - will create a summary table below with this
# final_tab_df = dplyr::count(df, df, sort = TRUE)
# colnames(final_tab_df) <- c('County Type', 'Number of Samples')
# knitr::kable(final_tab_df, caption="Final Samples by County", align = "c")
```


#### Additional Changes to the Data:

Upon final review of the dataset, there are no additional changes required to prepare the dataset for data exploration and subsequent model creation. Outliers or incorrect data are not observed upon final inspection. The Accounting Tables capture the changes made through cleaning and filtering as indicated previously.

## Exploratory Data Analysis


```{r EDA}
#Example Table
table1::label(df$total_pop) <- "TX County Population"
table1::label(df$cases) <- "TX County Covid-19 Cases"

table1::table1(~total_pop + cases | state, data = df)

#probably going to have to transform total_pop

ggplot(df, aes(x=total_pop)) + geom_histogram(bins=100)
ggplot(df, aes(x=cases)) + geom_histogram(bins=100)
ggplot(df, aes(x=deaths)) + geom_histogram(bins=100) 
ggplot(df, aes(x=long_trip)) + geom_histogram(bins=100)

df_test <- df


df_test <- df_test %>% mutate(County_Class = 
               case_when(df_test$total_pop <= 99999 ~ "Rural", 
                         df_test$total_pop >= 100000 ~ "Urban"))

# df_test$County_Rural <- ifelse(df_test$County_Class == "Rural", 1, 0) #will be useful for model
# df_test$County_Class <- as.factor(df_test$County_Class) #this turns 

ggpairs(df_test, columns = 5:(ncol(df)-1), title = "EDA: Variable Correlation",  
  axisLabels = "show", aes(colour = County_Class, alpha = 0.4))

```

Upon transformation of the data based on the figures above, we can see that poupulation size...

## A Model Building Process

## Linear Regression Results

```{r model creation}

#need to change these to per capita data
model1 <- lm(long_trip ~ cases + deaths, data = df) #limited model
model2 <- lm(, data = )
model3 <- lm(, data = ) #final model

#Run F test to show statistical significance of additional variables
anova(model1, model2, test = "F")
anova(model2, model3, test = "F")

#Run coeftest to show statistical significanve of all variables in the model
coeftest(model3, vcov = vcovHC(model3, type="HC1"))
```

## Discussion
###Model Limitations

<!-- Add language for model 2 and model 3 about CLM assumptions. -->

```{r CLM assumptions check}

#run this to display the CLM graphs needed to verify CLM assumptions met
#par(mfrow = c(2, 2))
#plot(model2)

##FINAL MODEL
#par(mfrow = c(2, 2))
#plot(model3)

```

###Omitted Variable 

<!-- If the team has taken up an explanatory (i.e. causal) question to evaluate, then identify what you think are the most important omitted variables that bias results you care about. For each variable you name, you should reason about the direction of bias caused by omitting this variable. If you can argue whether the bias is large or small, that is even better. State whether you have any variables available that may proxy (even imperfectly) for the omitted variable. Pay particular attention to whether each omitted variable bias is towards zero or away from zero. You will use this information to judge whether the effects you find are likely to be real, or whether they might be entirely an artifact of omitted variable bias. -->

#### Variable 1

One example of an omitted variable that may cause bias in our model is that of vehicle ownership among the population. It can certainly be expected that individuals that own a vehicle would be able to more easily travel short or long distances more frequently with relative ease. If an individual owned a vehicle, this would influence our model by driving the bias further from zero. From the data available, there would no immediate proxy for this omitted variable.

#### Variable 2

Another example of an omitted variable that may also cause bias in our model is fuel prices. Whether this is jet fuel or gasoline, fluctuations in this commodity would certainly impact travel costs. If fuel prices increase, it is generally observed that costs for travel increase. The opposite is also generally true. In the instance of increased fuel prices, this would influence our model by driving the bias closer to zero as distance traveled would drop. Conversely, if fuel prices for the time period of the sample for the population were lower, the bias would would be farther from zero.

## Conclusion & Next Steps

Based upon the linear regression analysis above, it is observed that there may be a causal relationship between XX and YY. The hypothesis posed within the introduction is 'failed to be rejected/ rejected.' ....

For future analysis, it is recommended that Covid-19 policy adherence data per county be incorporated into the model to increase the accuracy. While the Govenor of Texas issued detailed protocols or mandates for the state of Texas, the degree to which each county (and thus the individual residents) complied would be useful data to have if such data were to exist.

## References

